<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Provider | Local Hands</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="bg-dark text-white">
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-dark bg-opacity-75 backdrop-blur"
    >
      <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">Local Hands</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" href="/frontend/home.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/frontend/warnings.html"
                >Warnings</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/frontend/profile.html">Profile</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container mt-5">
      <h2 class="mb-4 text-center">Provider Details</h2>

      <!-- Datos del proveedor -->
      <div
        id="providerInfo"
        class="card bg-secondary p-4 rounded-4 shadow-lg mb-4"
      ></div>

      <!-- Productos del proveedor -->
      <h3 class="text-center mt-5">Products by Provider</h3>
      <div
        id="productsContainer"
        class="row g-4 justify-content-center mt-3"
      ></div>
    </div>
    <footer class="bg-dark text-white text-center py-4">
      <div class="container">
        <p class="mb-1">Â© 2025 Local Hands. All rights reserved.</p>
        <p class="mb-0">
          Contact us:
          <a
            href="mailto:contact@localhands.com"
            class="text-white text-decoration-underline"
            >contact@localhands.com</a
          >
        </p>
        <div class="mt-2">
          <a href="#" class="text-white me-3"><i class="bi bi-facebook"></i></a>
          <a href="#" class="text-white me-3"
            ><i class="bi bi-instagram"></i
          ></a>
          <a href="#" class="text-white"><i class="bi bi-twitter-x"></i></a>
        </div>
      </div>
    </footer>

    <script>
      async function loadProviderAndProducts() {
        const params = new URLSearchParams(window.location.search);
        const providerId = params.get("id");
        if (!providerId) {
          document.getElementById("providerInfo").innerHTML =
            "<p>Provider ID not found.</p>";
          return;
        }

        try {
          // Cargar proveedor
          const providerRes = await fetch(
            `http://localhost:3000/api/users/seeProviders/${providerId}`
          );
          if (!providerRes.ok)
            throw new Error("No se pudo cargar el proveedor");
          const provider = await providerRes.json();

          // Generar URL segura para la imagen
          let imageUrl = "https://via.placeholder.com/150";
          if (provider.imageUrl) {
            imageUrl = provider.imageUrl;
          }

          document.getElementById("providerInfo").innerHTML = `
          <div class="text-center">
            <img src="${imageUrl}" alt="Provider Image" class="img-fluid rounded-circle mb-3" style="max-width: 150px;">
            <h3>${provider.name}</h3>
            <p><strong>Location:</strong> ${provider.location || "No info"}</p>
            <p><strong>Description:</strong> ${
              provider.description || "No description"
            }</p>
          </div>
        `;

          // Cargar productos del proveedor
          const productsRes = await fetch(
            `http://localhost:3000/api/products?providerId=${providerId}`
          );
          if (!productsRes.ok)
            throw new Error("No se pudieron cargar los productos");
          const products = await productsRes.json();

          const container = document.getElementById("productsContainer");
          if (products.length === 0) {
            container.innerHTML = `<p class="text-center">No products found for this provider.</p>`;
            return;
          }

          products.forEach((prod) => {
            const col = document.createElement("div");
            col.className = "col-md-4";
            const image = prod.imageUrl ? prod.imageUrl : "https://via.placeholder.com/200";
            col.innerHTML = `
            <div class="card bg-dark bg-opacity-75 text-white rounded-4 shadow h-100">
              <img src="${image}" class="card-img-top" style="height:200px;object-fit:cover" alt="Product"/>
              <div class="card-body text-center">
                <h5 class="card-title fw-semibold">${prod.name}</h5>
                <p class="card-text">${prod.description || ""}</p>
                <p class="card-text"><strong>$${prod.price}</strong></p>
              </div>
            </div>
          `;
            container.appendChild(col);
          });
        } catch (err) {
          console.error(err);
          document.getElementById(
            "providerInfo"
          ).innerHTML = `<p>Error: ${err.message}</p>`;
        }
      }

      window.addEventListener("DOMContentLoaded", loadProviderAndProducts);
    </script>

    <!-- Bootstrap JS + iconos -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
  </body>
</html>
